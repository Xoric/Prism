package xoric.prism.com;

import java.util.ArrayList;
import java.util.List;

public class MessageDispatcher
{
	private static final int[] thresholds = { 0, 150, 400 };

	private class MessageEntry
	{
		public final Message message;
		public final int threshold;
		public int ageMs;

		public MessageEntry(Message message)
		{
			this.message = message;
			this.threshold = thresholds[message.getToken().getUrgency()];
		}

		public boolean isExpired()
		{
			return ageMs > threshold;
		}
	}

	private List<MessageEntry> list;

	public MessageDispatcher()
	{
		list = new ArrayList<MessageEntry>();
	}

	public void addMessage(Message m)
	{
		list.add(new MessageEntry(m));
	}

	public void update(int ms)
	{
		boolean sendNow = false;
		for (MessageEntry e : list)
		{
			e.ageMs += ms;
			sendNow |= e.isExpired();
		}
	}
}

package xoric.prism.meta;

import java.io.File;
import java.io.FileInputStream;
import java.io.FileNotFoundException;
import java.io.FileOutputStream;

import xoric.prism.data.modules.ActorID;
import xoric.prism.data.modules.ErrorCode;
import xoric.prism.data.modules.ErrorID;
import xoric.prism.data.modules.IActor;
import xoric.prism.exceptions.PrismMetaFileException;

public class MetaFile implements IActor
{
	private final File file;
	private final MetaList metaList;
	private final AttachmentLoader attachmentLoader;

	public MetaFile(File file)
	{
		this.file = file;
		this.metaList = new MetaList();
		this.attachmentLoader = new AttachmentLoader(file);
	}

	public void load() throws PrismMetaFileException
	{
		try
		{
			FileInputStream stream = new FileInputStream(file);
			metaList.unpack(stream);
			stream.close();
		}
		catch (Exception e0)
		{
			ErrorID id = e0 instanceof FileNotFoundException ? ErrorID.FILE_NOT_FOUND : ErrorID.GENERIC;
			ErrorCode c = new ErrorCode(this, id);
			PrismMetaFileException e = new PrismMetaFileException(c, file.toString());
			e.appendInfo(e0.toString());
			throw e;
		}
	}

	public void write()
	{
		try
		{
			FileOutputStream stream = new FileOutputStream(file);
			metaList.pack(stream);
		}
		catch (Exception e)
		{
			e.printStackTrace();
		}
	}

	public MetaList getMetaList()
	{
		return metaList;
	}

	@Override
	public ActorID getActorID()
	{
		return ActorID.META_FILE;
	}
}

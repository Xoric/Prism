package xoric.prism.world.loader;

import java.io.File;

import xoric.prism.common.Path;
import xoric.prism.common.loader.PrismLoader;
import xoric.prism.data.modules.ErrorCode;
import xoric.prism.data.modules.ErrorID;
import xoric.prism.exceptions.PrismMetaFileException;
import xoric.prism.meta.MetaBlock;
import xoric.prism.meta.MetaFile;
import xoric.prism.meta.MetaList;
import xoric.prism.meta.MetaType;
import xoric.prism.world.entities.Animation;

public class PrismWorldLoader extends PrismLoader
{
	protected PrismWorldLoader(Path dataPath)
	{
		super(dataPath);
	}

	public void loadAll()
	{
		loadAnimationDescriptions();
	}

	private void loadAnimationDescriptions()
	{
		File file = dataPath.getFile("common/toc.meta");
		MetaFile f = new MetaFile(file);
		f.load();
		MetaList metaList = f.getMetaList();
		MetaBlock metaBlock = metaList.findMetaBlock(MetaType.TOC);

		if (metaBlock == null)
		{
			ErrorCode c = new ErrorCode(this, ErrorID.META_BLOCK_MISSING);
			PrismMetaFileException e = new PrismMetaFileException(c, file);
			e.appendInfo("block", MetaType.TOC.toString());
			throw e;
		}
		Animation.loadDescriptions(metaBlock);
	}
}

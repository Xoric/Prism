package xoric.prism.scene.shaders;

import java.nio.ByteBuffer;

import xoric.prism.data.exceptions.PrismException;
import xoric.prism.data.global.FileTableDirectoryIndex;
import xoric.prism.data.global.Prism;
import xoric.prism.data.global.ShaderIndex;
import xoric.prism.data.meta.AttachmentLoader;
import xoric.prism.data.meta.MetaFile;
import xoric.prism.data.meta.MetaType;
import xoric.prism.data.meta.MetaList;

public class AllShaders
{
	public IShader2 defaultShader;

	public void load(IShaderIO shaderIO)
	{
		Prism.global.loadMetaFile(FileTableDirectoryIndex.SHADER, ShaderIndex.DEFAULT);
		defaultShader = loadShader(shaderIO, "");
	}

	private static IShader2 loadShader(IShaderIO shaderIO, String filename) throws PrismException
	{
		MetaFile mf = new MetaFile(Prism.global.getDataPath(), filename);
		mf.load();
		MetaList ml  = mf.getMetaList();
		ml.claimMetaBlock(MetaType.SHADER);
		AttachmentLoader al = mf.getAttachmentLoader();
		ByteBuffer vertexBuf = ByteBuffer.wrap(al.loadAttachment(0));
		ByteBuffer fragmentBuf = ByteBuffer.wrap(al.loadAttachment(1));
		IShader2 shader = shaderIO.createShader(vertexBuf, fragmentBuf);

		return shader;
	}
}

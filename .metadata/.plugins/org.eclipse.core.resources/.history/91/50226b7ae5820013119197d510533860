package xoric.prism.com;

import java.io.IOException;
import java.io.InputStream;
import java.io.OutputStream;
import java.security.NoSuchAlgorithmException;

import xoric.prism.data.exceptions.PrismException;
import xoric.prism.data.types.HeapPacker_s;
import xoric.prism.data.types.IText_r;

public class ClientLoginMessage extends Message
{
	private byte[] passwordBuffer;

	public ClientLoginMessage()
	{
		super(Token.LOGIN);
	}

	public void setPassword(IText_r pw) throws PrismException
	{
		try
		{
			passwordBuffer = PasswordHash.hash(pw.toString());
		}
		catch (NoSuchAlgorithmException e0)
		{
			PrismException e = new PrismException(e0);
			// ----
			e.user.setText("There was an error trying to encrypt your password. Your login attempt was therefore aborted.");
			// ----
			e.code.setText("error hashing a user password using " + PasswordHash.hashFunction);
			// ----
			throw e;
		}
	}
	
	@Override
	public void unpack(InputStream stream) throws IOException, PrismException
	{
		HeapPacker_s.unpack_s(stream, 2, heap);
	}

	@Override
	public void pack(OutputStream stream) throws IOException
	{
		HeapPacker_s.pack_s(stream, heap, 2);
	}
}

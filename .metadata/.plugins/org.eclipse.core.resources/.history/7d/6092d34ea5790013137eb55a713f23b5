package xoric.prism.creator.drawer.image;

import java.awt.Color;
import java.awt.Dimension;
import java.awt.GridBagConstraints;
import java.awt.GridBagLayout;
import java.awt.Image;
import java.awt.Insets;
import java.awt.event.ActionEvent;
import java.awt.event.ActionListener;

import javax.imageio.ImageIO;
import javax.swing.ImageIcon;
import javax.swing.JButton;
import javax.swing.JFrame;
import javax.swing.JPanel;

import xoric.prism.creator.drawer.model.AnimationModel;
import xoric.prism.creator.drawer.view.AnimationLine;
import xoric.prism.creator.drawer.view.IAnimationLine;
import xoric.prism.swing.PrismFrame;
import xoric.prism.world.entities.AnimationIndex;

public class AnimationView extends JPanel implements ActionListener, IAnimationView
{
	private static final long serialVersionUID = 1L;

	private final JButton backButton;
	//	private final JLabel nameLabel;

	private final IAnimationLine animationLine;
	private AngleSelectorPanel angleSelectorPanel;
	private AngleView angleView;

	public AnimationView()
	{
		super(new GridBagLayout());

		AnimationLine l = new AnimationLine(AnimationIndex.IDLE);
		animationLine = l;
		angleSelectorPanel = new AngleSelectorPanel();
		angleView = new AngleView();

		// create top panel
		JPanel topPanel = new JPanel(new GridBagLayout());

		GridBagConstraints c = new GridBagConstraints(0, 0, 1, 1, 0.0, 0.0, GridBagConstraints.WEST, GridBagConstraints.NONE, new Insets(0,
				0, 0, 0), 0, 0);
		topPanel.add(backButton = createButton("Back", null), c);

		c = new GridBagConstraints(0, 1, 1, 1, 1.0, 1.0, GridBagConstraints.WEST, GridBagConstraints.NONE, new Insets(0, 30, 0, 0), 0, 0);
		topPanel.add(l, c);

		// add controls
		c = new GridBagConstraints(0, 0, 2, 1, 1.0, 0.0, GridBagConstraints.CENTER, GridBagConstraints.BOTH, new Insets(0, 0, 0, 0), 0, 0);
		add(topPanel, c);

		c = new GridBagConstraints(1, 0, 2, 1, 0.0, 0.0, GridBagConstraints.CENTER, GridBagConstraints.NONE, new Insets(0, 0, 0, 0), 0, 0);
		add(angleSelectorPanel, c);

		c = new GridBagConstraints(1, 2, 1, 1, 0.0, 0.0, GridBagConstraints.CENTER, GridBagConstraints.BOTH, new Insets(0, 0, 0, 0), 0, 0);
		JPanel p = new JPanel();
		p.setOpaque(true);
		p.setBackground(Color.DARK_GRAY);
		Dimension d = new Dimension(300,60);
		p.setMinimumSize(d);
		add(p, c);

		c = new GridBagConstraints(1, 3, 1, 1, 0.0, 0.0, GridBagConstraints.CENTER, GridBagConstraints.NONE, new Insets(0, 0, 0, 0), 0, 0);
		add(angleView, c);
	}

	private JButton createButton(String s, String icon)
	{
		JButton b = new JButton();
		b.addActionListener(this);
		boolean hasIcon = false;
		try
		{
			if (icon != null && icon.length() > 0)
			{
				Image img = ImageIO.read(ClassLoader.getSystemResource(icon));
				ImageIcon icn = new ImageIcon(img);
				b.setIcon(icn);
				Dimension d = new Dimension(icn.getIconWidth(), icn.getIconHeight());
				b.setPreferredSize(d);
				b.setMinimumSize(d);
				b.setMaximumSize(d);
				hasIcon = true;
			}
		}
		catch (Exception e)
		{
		}
		if (!hasIcon)
			b.setText(s);

		return b;
	}

	public static void main(String[] args)
	{
		AnimationView p = new AnimationView();

		JFrame f = new PrismFrame("Test", 300, 300, true);
		f.setContentPane(p);

		f.setVisible(true);
	}

	@Override
	public void actionPerformed(ActionEvent e)
	{
		Object o = e.getSource();

		if (o == backButton)
			System.out.println("Back!");
	}

	@Override
	public void displayAnimationImages(AnimationModel m)
	{
		//		nameLabel.setText(m.getAnimationIndex().toString());
		animationLine.displayAnimation(m);
	}
}
